/**
    @name: aping-plugin-tumblr 
    @version: 0.7.6 (11-01-2016) 
    @author: Jonathan Hornung <jonathan.hornung@gmail.com> 
    @url: https://github.com/JohnnyTheTank/apiNG-plugin-tumblr 
    @license: MIT
*/
"use strict";var jjtApingTumblr=angular.module("jtt_aping_tumblr",["jtt_tumblr"]).directive("apingTumblr",["apingTumblrHelper","apingUtilityHelper","tumblrFactory",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=b.parseJsonFromAttributes(f.apingTumblr,a.getThisPlatformString(),h);i.forEach(function(d){var e={model:h.model};"undefined"!=typeof h.getNativeData?e.getNativeData=h.getNativeData:e.getNativeData=!1;var f={api_key:b.getApiCredentials(a.getThisPlatformString(),"api_key"),filter:"text"};if("undefined"!=typeof d.items?f.limit=d.items:f.limit=h.items,0==f.limit)return!1;if((f.limit<0||isNaN(f.limit))&&(f.limit=void 0),f.limit>20&&(f.limit=20),0===f.limit||"0"===f.limit)return!1;if("undefined"!=typeof d.tag&&(f.tag=d.tag),d.page){switch(f.page=d.page,h.model){case"image":f.type="photo";break;case"video":f.type="video";break;case"social":break;default:return!1}c.getPostsFromPage(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))})}})}}}]);jjtApingTumblr.service("apingTumblrHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlatformString=function(){return"tumblr"},this.getThisBlogLink=function(a){return"http://"+a+".tumblr.com/"},this.getDifference=function(a,b){return a>b?a-b:b-a},this.getImagesFromImageArray=function(a){var b=this,c={thumb_url:void 0,thumb_width:void 0,thumb_height:void 0,img_url:void 0,img_width:void 0,img_height:void 0,native_url:void 0,native_width:void 0,native_height:void 0};return a.constructor===Array&&angular.forEach(a,function(a,d){"undefined"!=typeof a.url&&("undefined"==typeof c.thumb_url?(c.thumb_url=a.url,c.thumb_width=a.width,c.thumb_height=a.height):b.getDifference(c.thumb_width,200)>b.getDifference(a.width,200)&&a.width>=200&&(c.thumb_url=a.url,c.thumb_width=a.width,c.thumb_height=a.height),"undefined"==typeof c.img_url?(c.img_url=a.url,c.img_width=a.width,c.img_height=a.height):b.getDifference(c.img_width,700)>b.getDifference(a.width,700)&&(c.img_url=a.url,c.img_width=a.width,c.img_height=a.height),"undefined"==typeof c.native_url?(c.native_url=a.url,c.native_width=a.width,c.native_height=a.height):a.width>c.native_width&&(c.native_url=a.url,c.native_width=a.width,c.native_height=a.height))}),c},this.getObjectByJsonData=function(a,b){var c=[];if(a&&a.data&&a.data.response){var d=this;a.data.response.posts&&angular.forEach(a.data.response.posts,function(a,e){var f;f=b.getNativeData===!0||"true"===b.getNativeData?a:d.getItemByJsonData(a,b.model),f&&c.push(f)})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b)switch(b){case"social":c=this.getSocialItemByJsonData(a);break;case"video":c=this.getVideoItemByJsonData(a);break;case"image":c=this.getImageItemByJsonData(a);break;default:return!1}return c},this.getSocialItemByJsonData=function(b){var c=a.getNew("social",this.getThisPlatformString());switch($.extend(!0,c,{blog_name:b.blog_name||void 0,blog_link:b.blog_name?this.getThisBlogLink(b.blog_name):void 0,type:b.type||void 0,timestamp:b.timestamp?1e3*b.timestamp:void 0,post_url:b.short_url||void 0,intern_id:b.id||void 0}),b.type){case"photo":if(c.text=b.caption||void 0,b.photos&&b.photos[0]&&b.photos[0].alt_sizes&&b.photos[0].alt_sizes.length>0){c.source=b.photos;var d=this.getImagesFromImageArray(b.photos[0].alt_sizes);"undefined"!=typeof d.img_url&&(c.img_url=d.img_url)}break;case"link":if(c.text=b.description||void 0,c.text?c.caption=b.title||void 0:c.text=b.title||void 0,b.photos&&b.photos[0]&&b.photos[0].alt_sizes&&b.photos[0].alt_sizes.length>0){var d=this.getImagesFromImageArray(b.photos[0].alt_sizes);"undefined"!=typeof d.img_url&&(c.img_url=d.img_url)}break;case"video":c.text=b.caption||void 0,b.thumbnail_url&&(c.img_url=b.thumbnail_url),b.player&&(c.source=b.player);break;case"text":c.text=b.body||void 0,c.text?c.caption=b.title||void 0:c.text=b.title||void 0;break;case"audio":c.text=b.caption||void 0,b.player&&(c.source=b.player);break;default:return!1}return c.date_time=new Date(c.timestamp),c},this.getVideoItemByJsonData=function(b){var c=a.getNew("video",this.getThisPlatformString());return $.extend(!0,c,{blog_name:b.blog_name||void 0,blog_link:b.blog_name?this.getThisBlogLink(b.blog_name):void 0,type:b.type||void 0,timestamp:b.timestamp?1e3*b.timestamp:void 0,post_url:b.short_url||void 0,intern_id:b.id||void 0,text:b.caption||void 0,img_url:b.thumbnail_url||void 0}),angular.forEach(b.player,function(a,b){("undefined"==typeof c.markup||a.width>c.width)&&(c.markup=a.embed_code,c.width=a.width)}),c.date_time=new Date(c.timestamp),c},this.getImageItemByJsonData=function(b){var c=a.getNew("image",this.getThisPlatformString());if($.extend(!0,c,{blog_name:b.blog_name||void 0,blog_link:b.blog_name?this.getThisBlogLink(b.blog_name):void 0,type:b.type||void 0,timestamp:b.timestamp?1e3*b.timestamp:void 0,post_url:b.short_url||void 0,intern_id:b.id||void 0}),c.text=b.caption||void 0,b.photos&&b.photos[0]&&b.photos[0].alt_sizes&&b.photos[0].alt_sizes.length>0){c.source=b.photos;var d=this.getImagesFromImageArray(b.photos[0].alt_sizes);$.extend(!0,c,d)}return c.date_time=new Date(c.timestamp),c}}]),angular.module("jtt_tumblr",[]).factory("tumblrFactory",["$http","tumblrSearchDataService",function(a,b){var c={};return c.getPostsFromPage=function(c){var d=b.getNew("postsFromPage",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c.getInfoFromPage=function(c){var d=b.getNew("infoFromPage",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c.getAvatarFromPage=function(c){var d=b.getNew("avatarFromPage",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c}]).service("tumblrSearchDataService",function(){this.getApiBaseUrl=function(a){var b;return b=a&&"undefined"!=typeof a.version?a.version+"/":"v2/","https://api.tumblr.com/"+b+"blog/"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){"undefined"!=typeof b[c]&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{api_key:b.api_key||void 0,callback:"JSON_CALLBACK"},url:""};switch("undefined"!=typeof b.limit&&(c.object.limit=b.limit),a){case"postsFromPage":c=this.fillDataInObjectByList(c,b,["type","id","tag","offset","reblog_info","notes_info","filter"]),c.url=this.getApiBaseUrl()+b.page+".tumblr.com/posts";break;case"infoFromPage":c.object.limit=void 0,c.url=this.getApiBaseUrl()+b.page+".tumblr.com/info";break;case"avatarFromPage":c.object.limit=void 0;var d="";"undefined"!=typeof b.size&&(d="/"+b.size),c.url=this.getApiBaseUrl()+b.page+".tumblr.com/avatar"+d}return c}});